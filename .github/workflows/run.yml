name: News Saúde - Daily Run

on:
  schedule:
    # Horário em UTC:
    # 12:00 UTC = 09:00 em São Paulo (sem horário de verão)
    - cron: "0 12 * * 1-5"   # segunda a sexta às 12:00 UTC
  workflow_dispatch: {}       # permite rodar manualmente pelo GitHub

jobs:
  run-news:
    runs-on: ubuntu-latest

    env:
      # Modo de execução (usado em send_email.py)
      RUN_MODE: ${{ github.event_name }}

      # Secrets da Brevo
      BREVO_API_KEY: ${{ secrets.BREVO_API_KEY }}
      BREVO_SENDER_EMAIL: ${{ secrets.BREVO_SENDER_EMAIL }}
      BREVO_SENDER_NAME: ${{ secrets.BREVO_SENDER_NAME }}

      # Destinatários diretos (fallback quando não usamos listas)
      TO_EMAILS: ${{ secrets.TO_EMAILS }}
      TO_EMAILS_MANUAL: ${{ secrets.TO_EMAILS_MANUAL }}

      # IDs de lista da Brevo (ex: "12" ou "12,34")
      BREVO_LIST_IDS: ${{ secrets.BREVO_LIST_IDS }}

      # URL do CTA de inscrição (Substack, formulário da Brevo etc.)
      NEWS_CTA_URL: ${{ secrets.NEWS_CTA_URL }}

      # Se você usar OpenAI ou outra API
      OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.11"

      # Passo opcional de debug, ajuda a confirmar onde está o main.py
      - name: Show repo structure
        run: |
          pwd
          ls -R

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          if [ -f requirements.txt ]; then
            pip install -r requirements.txt
          fi

      - name: Run newsletter pipeline
        run: |
          python src/main.py
